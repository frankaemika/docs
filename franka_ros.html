<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>franka_ros &mdash; Franka Control Interface (FCI)  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style_override.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="franka_ros2" href="franka_ros2.html" />
    <link rel="prev" title="libfranka" href="libfranka.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Franka Control Interface (FCI)
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Minimum system and network requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Compatible versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_linux.html">Installation on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="libfranka.html">libfranka</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">franka_ros</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#franka-description">franka_description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#collisions-volumes">Collisions Volumes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#franka-gripper">franka_gripper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#franka-hw">franka_hw</a></li>
<li class="toctree-l2"><a class="reference internal" href="#franka-control">franka_control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#franka-visualization">franka_visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#franka-example-controllers">franka_example_controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#franka-gazebo">franka_gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pick-place-example">Pick &amp; Place Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customization">Customization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frankahwsim">FrankaHWSim</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frankagrippersim">FrankaGripperSim</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jointstateinterface">JointStateInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#effortjointinterface">EffortJointInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frankastateinterface">FrankaStateInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frankamodelinterface">FrankaModelInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#friction">Friction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#franka-msgs">franka_msgs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#panda-moveit-config">panda_moveit_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-your-own-controller">Writing  your own controller</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="franka_ros2.html">franka_ros2</a></li>
<li class="toctree-l1"><a class="reference internal" href="franka_matlab/index.html">Franka Toolbox for MATLAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="franka_matlab/franka_matlab_changelog.html">Franka Toolbox for MATLAB changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_parameters.html">Robot and interface specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="fr3-certification-remarks.html">FR3 certification remarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Franka Control Interface (FCI)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>franka_ros</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/franka_ros.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="franka-ros">
<h1>franka_ros<a class="headerlink" href="#franka-ros" title="Permalink to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">franka_ros</span></code> is not supported on Windows.</p>
</div>
<p>Before continuing with this chapter, please <a class="reference internal" href="installation_linux.html"><span class="doc">install or compile franka_ros</span></a>.</p>
<p>You can access the changelog of franka_ros at <a class="reference external" href="https://github.com/frankarobotics/franka_ros/blob/develop/CHANGELOG.md">this link</a></p>
<figure class="align-center" id="id7">
<img alt="_images/ros-architecture.png" src="_images/ros-architecture.png" />
<figcaption>
<p><span class="caption-text">Schematic overview of the <code class="docutils literal notranslate"><span class="pre">franka_ros</span></code> packages.</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">franka_ros</span></code> metapackage integrates <code class="docutils literal notranslate"><span class="pre">libfranka</span></code> into ROS and ROS control.
Here, we introduce its packages and
we also give a short how-to for <a class="reference internal" href="#write-own-controller"><span class="std std-ref">writing controllers</span></a>.</p>
<p>All parameters passed to launch files in this section come with default values, so they
can be omitted if using the default network addresses and ROS namespaces.
Make sure the <code class="docutils literal notranslate"><span class="pre">source</span></code> command was called with the setup script from your workspace:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/path/to/catkin_ws/devel/setup.sh
</pre></div>
</div>
<section id="franka-description">
<h2>franka_description<a class="headerlink" href="#franka-description" title="Permalink to this heading"></a></h2>
<p>This package contains the description of our robots and end effectors in terms of kinematics, joint
limits, visual surfaces and collision space. The collision space is a simplified version of the
visual description used to improve performance of collision checks. The descriptions are based on
the URDF format according to the <a class="reference external" href="http://wiki.ros.org/urdf/XML">URDF XML documentation</a> .</p>
<p>If you want to simulate the FR3 robots, you can pass a <code class="docutils literal notranslate"><span class="pre">gazebo</span></code> argument to the XACRO file.
<a class="reference external" href="https://github.com/frankarobotics/franka_description">franka_description</a>  contains the files for all the Franka Robotics robot models.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>xacro<span class="w"> </span><span class="k">$(</span>rospack<span class="w"> </span>find<span class="w"> </span>franka_description<span class="k">)</span>/robots/fr3/fr3.urdf.xacro<span class="w"> </span>gazebo:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>The same works for FER(Panda):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>xacro<span class="w"> </span><span class="k">$(</span>rospack<span class="w"> </span>find<span class="w"> </span>franka_description<span class="k">)</span>/robots/panda/panda.urdf.xacro<span class="w"> </span>gazebo:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<section id="collisions-volumes">
<h3>Collisions Volumes<a class="headerlink" href="#collisions-volumes" title="Permalink to this heading"></a></h3>
<p>The URDF defines two types of collision types:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Fine</strong>: These collision volumes are made from convex meshes which are approximated and
drastically simplified versions of the visual meshes (.dae) of each link. The fine volumes
should be used for simulating robot collisions in <a class="reference internal" href="#franka-gazebo"><span class="std std-ref">Gazebo</span></a></p></li>
<li><p><strong>Coarse</strong>: These collision volumes are simply capsules (a cylinder with two semispherical
end caps) attached to each link and inflated by a certain safety distance. These volumes
are more efficient to compute and are used internally in the robot for self-collision
avoidance. Use these geometries when you are planning motions e.g. with <a class="reference external" href="https://moveit.ros.org/">MoveIt</a>.</p></li>
</ul>
</div></blockquote>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Visual</p></td>
<td><p>Collision (Fine)</p></td>
<td><p>Collision (Coarse)</p></td>
</tr>
<tr class="row-even"><td><img alt="_images/visual.png" src="_images/visual.png" />
</td>
<td><img alt="_images/collision-fine.png" src="_images/collision-fine.png" />
</td>
<td><img alt="_images/collision-coarse.png" src="_images/collision-coarse.png" />
</td>
</tr>
</tbody>
</table>
<p>To distinguish between the two types of collision models artificial links are inserted in the URDF
with an <code class="docutils literal notranslate"><span class="pre">*_sc</span></code> suffix (for self-collision):</p>
<div class="line-block">
<div class="line"><strong>panda_link0</strong></div>
<div class="line">├─ <strong>panda_link0_sc</strong></div>
<div class="line">└─ <strong>panda_link1</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link1_sc</strong></div>
<div class="line">└─ <strong>panda_link2</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link2_sc</strong></div>
<div class="line">└─ <strong>panda_link3</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link3_sc</strong></div>
<div class="line">└─ <strong>panda_link4</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link4_sc</strong></div>
<div class="line">└─ <strong>panda_link5</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link5_sc</strong></div>
<div class="line">└─ <strong>panda_link6</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link6_sc</strong></div>
<div class="line">└─ <strong>panda_link7</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link7_sc</strong></div>
<div class="line">└─ <strong>panda_link8</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_link8_sc</strong></div>
<div class="line">└─ <strong>panda_hand</strong></div>
<div class="line-block">
<div class="line">├─ <strong>panda_leftfinger</strong></div>
<div class="line">├─ <strong>panda_rightfinger</strong></div>
<div class="line">├─ <strong>panda_hand_sc</strong></div>
<div class="line">└─ <strong>panda_hand_tcp</strong></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>You can control which collision model is loaded into your URDF via the <code class="docutils literal notranslate"><span class="pre">gazebo</span></code> XACRO argument:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xacro</span> <span class="pre">...</span> <span class="pre">panda.urdf.xacro</span> <span class="pre">gazebo:=false</span></code>: This will use <em>both</em> the fine and coarse collision model.
This is also the default if you omit the arg entirely. Use this when you want to use MoveIt</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xacro</span> <span class="pre">...</span> <span class="pre">panda.urdf.xacro</span> <span class="pre">gazebo:=true</span></code>: This will use <em>only</em> the fine collision model. Use
this when you want a simulatable URDF i.e. for Gazebo. When using the coarse collision model the robot
will of course be in constant collision with the capsules of the next link.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="franka-gripper">
<span id="id2"></span><h2>franka_gripper<a class="headerlink" href="#franka-gripper" title="Permalink to this heading"></a></h2>
<p>This package implements the <code class="docutils literal notranslate"><span class="pre">franka_gripper_node</span></code> for interfacing a gripper from ROS.
The node publishes the state of the gripper and offers the following <cite>actions servers</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">franka_gripper::MoveAction(width,</span> <span class="pre">speed)</span></code>: moves to a target <code class="docutils literal notranslate"><span class="pre">width</span></code> with the defined
<code class="docutils literal notranslate"><span class="pre">speed</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_gripper::GraspAction(width,</span> <span class="pre">epsilon_inner,</span> <span class="pre">epsilon_outer,</span> <span class="pre">speed,</span> <span class="pre">force)</span></code>: tries to
grasp at the desired <code class="docutils literal notranslate"><span class="pre">width</span></code> with a desired <code class="docutils literal notranslate"><span class="pre">force</span></code> while closing with the given <code class="docutils literal notranslate"><span class="pre">speed</span></code>. The
operation is successful if the distance <span class="math notranslate nohighlight">\(d\)</span> between the gripper fingers is:
<span class="math notranslate nohighlight">\(\text{width} - \epsilon_\text{inner} &lt; d &lt; \text{width} + \epsilon_\text{outer}\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_gripper::HomingAction()</span></code>: homes the gripper and updates the maximum width given the
mounted fingers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_gripper::StopAction()</span></code>: aborts a running action. This can be used to stop applying
forces after grasping.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">control_msgs::GripperCommandAction(width,</span> <span class="pre">max_effort)</span></code>: A standard gripper action
recognized by MoveIt!. If the argument <code class="docutils literal notranslate"><span class="pre">max_effort</span></code> is greater than zero, the gripper
will try to grasp an object of the desired <code class="docutils literal notranslate"><span class="pre">width</span></code>. On the other hand, if <code class="docutils literal notranslate"><span class="pre">max_effort</span></code> is
zero (<span class="math notranslate nohighlight">\(\text{max_effort} &lt; 1^{-4}\)</span>), the gripper will move to the desired <code class="docutils literal notranslate"><span class="pre">width</span></code>.</p></li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the argument <code class="docutils literal notranslate"><span class="pre">max_effort</span></code> only when grasping an object, otherwise, the gripper will
close ignoring the <code class="docutils literal notranslate"><span class="pre">width</span></code> argument.</p>
</div>
</div></blockquote>
</div></blockquote>
<p>You can launch the <code class="docutils literal notranslate"><span class="pre">franka_gripper_node</span></code> with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_gripper<span class="w"> </span>franka_gripper.launch<span class="w"> </span>robot_ip:<span class="o">=</span>&lt;fci-ip&gt;
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Starting with <code class="docutils literal notranslate"><span class="pre">franka_ros</span></code> 0.6.0, specifying <code class="docutils literal notranslate"><span class="pre">load_gripper:=true</span></code> for
<code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">franka_control</span> <span class="pre">franka_control.launch</span></code> will start a <code class="docutils literal notranslate"><span class="pre">franka_gripper_node</span></code> as well.</p>
</div>
</section>
<section id="franka-hw">
<span id="id3"></span><h2>franka_hw<a class="headerlink" href="#franka-hw" title="Permalink to this heading"></a></h2>
<p>This package contains the hardware abstraction of the robot for the ROS control framework
based on the <code class="docutils literal notranslate"><span class="pre">libfranka</span></code> API. The hardware class <code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaHW</span></code> is implemented in this
package offering the following interfaces to controllers:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::JointStateInterface</span></code></p></td>
<td><p>Reads joint states.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::VelocityJointInterface</span></code></p></td>
<td><p>Commands joint velocities and reads joint
states.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::PositionJointInterface</span></code></p></td>
<td><p>Commands joint positions and reads joint
states.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::EffortJointInterface</span></code></p></td>
<td><p>Commands joint-level torques and reads
joint states.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaStateInterface</span></code></p></td>
<td><p>Reads the full robot state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaPoseCartesianInterface</span></code></p></td>
<td><p>Commands Cartesian poses and reads the full
robot state.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaVelocityCartesianInterface</span></code></p></td>
<td><p>Commands Cartesian velocities and reads the
full robot state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaModelInterface</span></code></p></td>
<td><p>Reads the dynamic and kinematic model of the
robot.</p></td>
</tr>
</tbody>
</table>
<p>To use ROS control interfaces, you have to retrieve resource handles by name:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Resource handle name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::JointStateInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_joint1” to “&lt;arm_id&gt;_joint7”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::VelocityJointInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_joint1” to “&lt;arm_id&gt;_joint7”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::PositionJointInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_joint1” to “&lt;arm_id&gt;_joint7”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::EffortJointInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_joint1” to “&lt;arm_id&gt;_joint7”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaStateInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_robot”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaPoseCartesianInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_robot”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaVelocityCartesianInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_robot”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaModelInterface</span></code></p></td>
<td><p>“&lt;arm_id&gt;_robot”</p></td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>By default, &lt;arm_id&gt; is set to “panda”.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaHW</span></code> class also implements the starting, stopping and switching of
controllers.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FrankaHW</span></code> class also serves as base class for <code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code>, a hardware class that
can be combined with others to control multiple robots from a single controller. The combination of
an arbitrary number of Panda robots (number configured by parameters) based on <code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code>
for the ROS control framework <a class="reference external" href="https://github.com/ros-controls/ros_control">https://github.com/ros-controls/ros_control</a> is implemented
in <code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code>. The key-difference between <code class="docutils literal notranslate"><span class="pre">FrankaHW</span></code> and <code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> is
that the latter supports torque control only.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code> class is available from version 0.7.0 and allows torque/effort control only.</p>
</div>
<p>The ROS parameter server is used to determine at runtime which robots are loaded in the combined
class. For an example on how to configure the <code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> in the according hardware node,
see <a class="reference internal" href="#franka-control"><span class="std std-ref">franka_control</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The approach of <code class="docutils literal notranslate"><span class="pre">FrankaHW</span></code> is optimal for controlling single robots. Thus we recommend using
the <code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code>/<code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> classes only for controlling multiple robots.</p>
</div>
<p>The interfaces offered by the <code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code>/<code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> classes are the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::EffortJointInterface</span></code></p></td>
<td><p>Commands joint-level torques and reads
joint states.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::JointStateInterface</span></code></p></td>
<td><p>Reads joint states.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaStateInterface</span></code></p></td>
<td><p>Reads the full robot state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaModelInterface</span></code></p></td>
<td><p>Reads the dynamic and kinematic model of the
robot.</p></td>
</tr>
</tbody>
</table>
<p>The only admissible command interface claim is the <code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> which can be combined
with any set of read-only-interfaces (<code class="docutils literal notranslate"><span class="pre">FrankaModelInterface</span></code>, <code class="docutils literal notranslate"><span class="pre">JointStateInterface</span></code>,
<code class="docutils literal notranslate"><span class="pre">FrankaStateInterface</span></code>). The resource handles offered by all interfaces are claimed by name and
follow the same naming conventions as described for <cite>FrankaHW</cite>. Every instance of
<code class="docutils literal notranslate"><span class="pre">FrankaCombinableHW</span></code> offers the complete set of service and action interfaces
(see <a class="reference internal" href="#franka-control"><span class="std std-ref">franka_control</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> class offers an additional action server in the control node namespace
to recover all robots. If a reflex or error occurs on any of the robots, the control loop of all
robots stops until they are recovered.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">FrankaHW</span></code> makes use of the ROS <a class="reference external" href="http://wiki.ros.org/ros_control#Joint_limits_interface">joint_limits_interface</a>
to <a class="reference external" href="http://wiki.ros.org/pr2_controller_manager/safety_limits">enforce position, velocity and effort safety limits</a>.
The utilized interfaces are listed below:</p>
<blockquote>
<div><ul class="simple">
<li><p>joint_limits_interface::PositionJointSoftLimitsInterface</p></li>
<li><p>joint_limits_interface::VelocityJointSoftLimitsInterface</p></li>
<li><p>joint_limits_interface::EffortJointSoftLimitsInterface</p></li>
</ul>
</div></blockquote>
<p>Approaching the limits will result in the (unannounced) modification of the commands.</p>
</div>
</section>
<section id="franka-control">
<span id="id4"></span><h2>franka_control<a class="headerlink" href="#franka-control" title="Permalink to this heading"></a></h2>
<p>The ROS nodes <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code> and <code class="docutils literal notranslate"><span class="pre">franka_combined_control_node</span></code> are hardware nodes
for ROS control that use according hardware classes from <code class="docutils literal notranslate"><span class="pre">franka_hw</span></code>. They provide a variety
of ROS services to expose the full <code class="docutils literal notranslate"><span class="pre">libfranka</span></code> API in the ROS ecosystem. The following services
are provided:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetJointImpedance</span></code> specifies joint stiffness for the internal controller
(damping is automatically derived from the stiffness).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetCartesianImpedance</span></code> specifies Cartesian stiffness for the internal
controller (damping is automatically derived from the stiffness).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetEEFrame</span></code> specifies the transformation from &lt;arm_id&gt;_EE (end effector) to
&lt;arm_id&gt;_NE (nominal end effector) frame. The transformation from flange to end effector frame
is split into two transformations: &lt;arm_id&gt;_EE to &lt;arm_id&gt;_NE frame and &lt;arm_id&gt;_NE to
&lt;arm_id&gt;_link8 frame. The transformation from &lt;arm_id&gt;_NE to &lt;arm_id&gt;_link8 frame can only be
set through the administrator’s interface.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetKFrame</span></code> specifies the transformation from &lt;arm_id&gt;_K to &lt;arm_id&gt;_EE frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetForceTorqueCollisionBehavior</span></code> sets thresholds for external Cartesian
wrenches to configure the collision reflex.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetFullCollisionBehavior</span></code> sets thresholds for external forces on Cartesian
and joint level to configure the collision reflex.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">franka_msgs::SetLoad</span></code> sets an external load to compensate (e.g. of a grasped object).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std_srvs::Trigger</span></code> services allow to connect and disconnect your hardware node
(available from 0.8.0). When no active (commanding) controller is running, you can disconnect
the hardware node, freeing the respective robots for non-fci applications like e.g. Desk-based
operations. Once you want to resume fci operations you can call connect and start your
ros_control based controllers again.</p></li>
</ul>
</div></blockquote>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The &lt;arm_id&gt;_EE frame denotes the part of the
configurable end effector frame which can be adjusted during run time through <cite>franka_ros</cite>. The
&lt;arm_id&gt;_K frame marks the center of the internal
Cartesian impedance. It also serves as a reference frame for external wrenches. <em>Neither the
&lt;arm_id&gt;_EE nor the &lt;arm_id&gt;_K are contained in the URDF as they can be changed at run time</em>.
By default, &lt;arm_id&gt; is set to “panda”.</p>
<figure class="align-center" id="id8">
<img alt="_images/frames.svg" src="_images/frames.svg" /><figcaption>
<p><span class="caption-text">Overview of the end-effector frames.</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<p>To recover from errors and reflexes when the robot is in reflex mode, you can utilize the
<code class="docutils literal notranslate"><span class="pre">franka_msgs::ErrorRecoveryAction</span></code>. This can be achieved through either an action client or by publishing on the
action goal topic.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>rostopic<span class="w"> </span>pub<span class="w"> </span>-1<span class="w"> </span>/franka_control/error_recovery/goal<span class="w"> </span>franka_msgs/ErrorRecoveryActionGoal<span class="w"> </span><span class="s2">&quot;{}&quot;</span>
</pre></div>
</div>
<p>After recovery, the <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code> restarts the controllers that were running. That is
possible as the node does not die when robot reflexes are triggered or when errors have occurred.
All of these functionalities are provided by the <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code> which can be launched
with the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_control<span class="w"> </span>franka_control.launch<span class="w"> </span><span class="se">\</span>
robot_ip:<span class="o">=</span>&lt;fci-ip&gt;<span class="w"> </span><span class="c1"># mandatory \</span>
load_gripper:<span class="o">=</span>&lt;true<span class="p">|</span>false&gt;<span class="w"> </span><span class="c1"># default: true \</span>
robot:<span class="o">=</span>&lt;panda<span class="p">|</span>fr3&gt;<span class="w"> </span><span class="c1"># default: panda</span>
</pre></div>
</div>
<p>Besides loading the <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code>, the launch file also starts a
<code class="docutils literal notranslate"><span class="pre">franka_control::FrankaStateController</span></code> for reading and publishing the robot states, including
external wrenches, configurable transforms and the joint states required for visualization with
rviz. For visualization purposes, a <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> is started.</p>
<p>This package also implements the <code class="docutils literal notranslate"><span class="pre">franka_combined_control_node</span></code>, a hardware node for <code class="docutils literal notranslate"><span class="pre">ros_control</span></code> based
on the <code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaCombinedHW</span></code> class. The set of robots loaded are configured via the ROS parameter
server. These parameters have to be in the hardware node’s namespace (see <a class="reference external" href="https://github.com/frankarobotics/franka_ros/tree/develop/franka_control/config/franka_combined_control_node.yaml">franka_combined_control_node.yaml</a>
as a reference) and look like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">robot_hardware</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2</span>
<span class="w">  </span><span class="c1"># (...)</span>

<span class="nt">panda_1</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">franka_hw/FrankaCombinableHW</span>
<span class="w">  </span><span class="nt">arm_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1</span>
<span class="w">  </span><span class="nt">joint_names</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint5</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint6</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint7</span>
<span class="w">  </span><span class="c1"># Configure the threshold angle for printing joint limit warnings.</span>
<span class="w">  </span><span class="nt">joint_limit_warning_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"> </span><span class="c1"># [rad]</span>
<span class="w">  </span><span class="c1"># Activate rate limiter? [true|false]</span>
<span class="w">  </span><span class="nt">rate_limiting</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># Cutoff frequency of the low-pass filter. Set to &gt;= 1000 to deactivate.</span>
<span class="w">  </span><span class="nt">cutoff_frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="c1"># Internal controller for motion generators [joint_impedance|cartesian_impedance]</span>
<span class="w">  </span><span class="nt">internal_controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint_impedance</span>
<span class="w">  </span><span class="c1"># Configure the initial defaults for the collision behavior reflexes.</span>
<span class="w">  </span><span class="nt">collision_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lower_torque_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">upper_torque_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">lower_torque_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">upper_torque_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">lower_force_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">upper_force_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">lower_force_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">upper_force_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>

<span class="nt">panda_2</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">franka_hw/FrankaCombinableHW</span>
<span class="w">  </span><span class="nt">arm_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2</span>
<span class="w">  </span><span class="nt">joint_names</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint5</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint6</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint7</span>
<span class="w">  </span><span class="c1"># Configure the threshold angle for printing joint limit warnings.</span>
<span class="w">  </span><span class="nt">joint_limit_warning_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"> </span><span class="c1"># [rad]</span>
<span class="w">  </span><span class="c1"># Activate rate limiter? [true|false]</span>
<span class="w">  </span><span class="nt">rate_limiting</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># Cutoff frequency of the low-pass filter. Set to &gt;= 1000 to deactivate.</span>
<span class="w">  </span><span class="nt">cutoff_frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="c1"># Internal controller for motion generators [joint_impedance|cartesian_impedance]</span>
<span class="w">  </span><span class="nt">internal_controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint_impedance</span>
<span class="w">  </span><span class="c1"># Configure the initial defaults for the collision behavior reflexes.</span>
<span class="w">  </span><span class="nt">collision_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lower_torque_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">upper_torque_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">lower_torque_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">upper_torque_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">18.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [Nm]</span>
<span class="w">    </span><span class="nt">lower_force_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">upper_force_thresholds_acceleration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">lower_force_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>
<span class="w">    </span><span class="nt">upper_force_thresholds_nominal</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">25.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># [N, N, N, Nm, Nm, Nm]</span>

<span class="c1"># (+ more robots ...)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be sure to choose unique and consistent <code class="docutils literal notranslate"><span class="pre">arm_id</span></code> parameters. The IDs must match the prefixes
in the joint names and should be according to the robot description loaded to the control
node’s namespace.</p>
</div>
<p>For more information on the parameter based loading of hardware classes, please refer to the
official documentation of <code class="docutils literal notranslate"><span class="pre">combined_robot_hw::CombinedRobotHW</span></code> from
<a class="reference external" href="https://github.com/ros-controls/ros_control">https://github.com/ros-controls/ros_control</a>.</p>
<p>A second important parameter file
(see franka_ros/franka_control/config/default_combined_controllers.yaml as a reference) configures
a set of default controllers that can be started with the hardware node. The controllers have to match
the launched hardware. The provided default parameterization (here for 2 robots) looks like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">panda_1_state_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">franka_control/FrankaStateController</span>
<span class="w">  </span><span class="nt">arm_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1</span>
<span class="w">  </span><span class="nt">joint_names</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint5</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint6</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_1_joint7</span>
<span class="w">  </span><span class="nt">publish_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w">  </span><span class="c1"># [Hz]</span>

<span class="nt">panda_2_state_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">franka_control/FrankaStateController</span>
<span class="w">  </span><span class="nt">arm_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2</span>
<span class="w">  </span><span class="nt">joint_names</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint3</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint5</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint6</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">panda_2_joint7</span>
<span class="w">  </span><span class="nt">publish_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w">  </span><span class="c1"># [Hz]</span>

<span class="c1"># (+ more controllers ...)</span>
</pre></div>
</div>
<p>We provide a launch file to run the <code class="docutils literal notranslate"><span class="pre">franka_combined_control_node</span></code> with user specified configuration
files for hardware and controllers which default to a configuration with 2 robots. Launch it with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_control<span class="w"> </span>franka_combined_control.launch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>robot_ips:<span class="o">=</span>&lt;your_robot_ips_as_a_map&gt;<span class="w">                 </span><span class="c1"># mandatory</span>
<span class="w">    </span>robot:<span class="o">=</span>&lt;path_to_your_robot_description&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>args:<span class="o">=</span>&lt;xacro_args_passed_to_the_robot_description&gt;<span class="w"> </span><span class="se">\ </span><span class="c1"># if needed</span>
<span class="w">    </span>robot_id:<span class="o">=</span>&lt;name_of_your_multi_robot_setup&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>hw_config_file:<span class="o">=</span>&lt;path_to_your_hw_config_file&gt;<span class="se">\ </span><span class="w">      </span><span class="c1"># includes the robot ips!</span>
<span class="w">    </span>controllers_file:<span class="o">=</span>&lt;path_to_your_default_controller_parameterization&gt;<span class="se">\</span>
<span class="w">    </span>controllers_to_start:<span class="o">=</span>&lt;list_of_default_controllers_to_start&gt;<span class="se">\</span>
<span class="w">    </span>joint_states_source_list:<span class="o">=</span>&lt;list_of_sources_to_fuse_a_complete_joint_states_topic&gt;
</pre></div>
</div>
<p>This launch file can be parameterized to run an arbitrary number of robots.
To do so just write your own configuration files in the style of
franka_control/config/franka_combined_control_node.yaml and
franka_ros/franka_control/config/default_combined_controllers.yaml.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be sure to pass the correct IPs of your robots to <cite>franka_combined_control.launch</cite> as a map.
This looks like: <cite>{&lt;arm_id_1&gt;/robot_ip: &lt;my_ip_1&gt;, &lt;arm_id_2&gt;/robot_ip: &lt;my_ip_2&gt;, …}</cite></p>
</div>
</section>
<section id="franka-visualization">
<span id="ros-visualization"></span><h2>franka_visualization<a class="headerlink" href="#franka-visualization" title="Permalink to this heading"></a></h2>
<p>This package contains publishers that connect to a robot and publish the robot and
gripper joint states for visualization in RViz. To run this package launch:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_visualization<span class="w"> </span>franka_visualization.launch<span class="w"> </span>robot_ip:<span class="o">=</span>&lt;fci-ip&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>load_gripper:<span class="o">=</span>&lt;true<span class="p">|</span>false&gt;<span class="w"> </span>robot:<span class="o">=</span>&lt;panda<span class="p">|</span>fr3&gt;
</pre></div>
</div>
<p>This is purely for visualization - no commands are sent to the robot. It can be useful to check the
connection to the robot.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Only one instance of a <code class="docutils literal notranslate"><span class="pre">franka::Robot</span></code> can connect to the robot. This means, that for example
the <code class="docutils literal notranslate"><span class="pre">franka_joint_state_publisher</span></code> cannot run in parallel to the <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code>.
This also implies that you cannot execute the visualization example alongside a separate
program running a controller.</p>
</div>
</section>
<section id="franka-example-controllers">
<span id="example-controllers"></span><h2>franka_example_controllers<a class="headerlink" href="#franka-example-controllers" title="Permalink to this heading"></a></h2>
<p>In this package a set of example controllers for controlling the robot via ROS are implemented.
The controllers depict the variety of interfaces offered by the <code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaHW</span></code> class and
the according usage. Each example comes with a separate stand-alone launch file that starts the
controller on the robot and visualizes it.</p>
<p>To launch the joint impedance example, execute the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_example_controllers<span class="w"> </span>joint_impedance_example_controller.launch<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>robot_ip:<span class="o">=</span>&lt;fci-ip&gt;<span class="w"> </span>load_gripper:<span class="o">=</span>&lt;true<span class="p">|</span>false&gt;<span class="w"> </span>robot:<span class="o">=</span>&lt;panda<span class="p">|</span>fr3&gt;
</pre></div>
</div>
<p>Other single Panda examples are started in the same way.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dual_arm_cartesian_impedance_example_controller</span></code> showcases the control of two Panda robots
based on <code class="docutils literal notranslate"><span class="pre">FrankaCombinedHW</span></code> using one realtime controller for fulfilling Cartesian tasks with
an impedance-based control approach. The example controller can be launched with</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_example_controllers<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>dual_arm_cartesian_impedance_example_controller.launch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>robot_id:<span class="o">=</span>&lt;name_of_the_2_arm_setup&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>robot_ips:<span class="o">=</span>&lt;your_robot_ips_as_a_map&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rviz:<span class="o">=</span>&lt;true/false&gt;<span class="w"> </span>rqt:<span class="o">=</span>&lt;true/false&gt;
</pre></div>
</div>
<p>The example assumes a robot configuration according to <cite>dual_panda_example.urdf.xacro</cite> where two
Pandas are mounted at 1 meter distance on top of a box. Feel free to replace this robot description
with one that matches your setup.
The option <cite>rviz</cite> allows to choose whether a visualization should be launched. With <cite>rqt</cite> the user
can choose to launch an rqt-gui which allows an online adaption of the rendered end-effector
impedances at runtime via dynamic reconfigure.</p>
</section>
<section id="franka-gazebo">
<span id="id6"></span><h2>franka_gazebo<a class="headerlink" href="#franka-gazebo" title="Permalink to this heading"></a></h2>
<p>This package allows you to simulate our robot in <a class="reference external" href="https://gazebosim.org/">Gazebo</a>. This is possible
because Gazebo is able to integrate into the ROS control framework with the
<a class="reference external" href="https://classic.gazebosim.org/tutorials?tut=ros_control&amp;cat=connect_ros">gazebo_ros</a> package.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This package is available from 0.8.0</p>
</div>
<section id="pick-place-example">
<h3>Pick &amp; Place Example<a class="headerlink" href="#pick-place-example" title="Permalink to this heading"></a></h3>
<p>Let’s dive in and simulate transporting a stone from A to B. Run the following command to start Gazebo with a Panda
and an example world.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>franka_gazebo<span class="w"> </span>panda.launch<span class="w"> </span>x:<span class="o">=</span>-0.5<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>world:<span class="o">=</span><span class="k">$(</span>rospack<span class="w"> </span>find<span class="w"> </span>franka_gazebo<span class="k">)</span>/world/stone.sdf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>controller:<span class="o">=</span>cartesian_impedance_example_controller<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rviz:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>This will bring up the Gazebo GUI where you see the environment with the stone and RViz with which you can control
the end-effector pose of the robot.</p>
<figure class="align-center" id="id9">
<img alt="_images/franka-gazebo-example.png" src="_images/franka-gazebo-example.png" />
<figcaption>
<p><span class="caption-text">Gazebo GUI (left) and RViz (right) of the pick and place example</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>To open the gripper, simply send a goal to the <code class="docutils literal notranslate"><span class="pre">move</span></code> action, similar to how the real <code class="docutils literal notranslate"><span class="pre">franka_gripper</span></code>
works. Let’s move the gripper to a width of <span class="math notranslate nohighlight">\(8\:cm\)</span> between the fingers with <span class="math notranslate nohighlight">\(10\:\frac{cm}{s}\)</span>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>rostopic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>/franka_gripper/move/goal<span class="w"> </span>franka_gripper/MoveActionGoal<span class="w"> </span><span class="s2">&quot;goal: { width: 0.08, speed: 0.1 }&quot;</span>
</pre></div>
</div>
<p>Since we launched our robot with the Cartesian Impedance controller from
<a class="reference internal" href="#example-controllers"><span class="std std-ref">franka_example_controllers</span></a>, we can move the end-effector around, just like in reality,
with the interactive marker gizmo in RViz. Move the robot such that the white stone is between the fingers of the
gripper ready to be picked up.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the robot moves strangely with the elbow, this is because the default nullspace stiffness of the cartesian
impedance example controller is set to low. Launch <a class="reference external" href="http://wiki.ros.org/rqt_reconfigure">Dynamic Reconfigure</a>
and adjust <code class="docutils literal notranslate"><span class="pre">panda</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">cartesian_impedance_example_controller</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">nullspace_stiffness</span></code> if necessary.</p>
</div>
<p>To pick up the object, we use the <code class="docutils literal notranslate"><span class="pre">grasp</span></code> action this time, since we want to excerpt a force after
the grasp to not drop the object. The stone is around <span class="math notranslate nohighlight">\(3\:cm\)</span> wide and <span class="math notranslate nohighlight">\(50\:g\)</span> heavy.
Let’s grasp it with <span class="math notranslate nohighlight">\(5\:N\)</span>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>rostopic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>/franka_gripper/grasp/goal<span class="w"> </span><span class="se">\</span>
<span class="w">             </span>franka_gripper/GraspActionGoal<span class="w"> </span><span class="se">\</span>
<span class="w">             </span><span class="s2">&quot;goal: { width: 0.03, epsilon:{ inner: 0.005, outer: 0.005 }, speed: 0.1, force: 5.0}&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In top menu of Gazebo go to <strong>View</strong> &gt; <strong>Contacts</strong> to visualize contact points and forces</p>
</div>
<p>If the grasp succeeded, the fingers will now hold the stone in place. If not, probably the goal tolerances (inner
and outer epsilon) were too small and the action failed. Now move the object gently over to the red dropoff area.</p>
<figure class="align-center" id="id10">
<img alt="_images/franka-gazebo-example-grasp.png" src="_images/franka-gazebo-example-grasp.png" />
<figcaption>
<p><span class="caption-text">Transport the stone from blue to red</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>After you placed it gently on the red pad, stop the grasp with the <code class="docutils literal notranslate"><span class="pre">stop</span></code> action from the gripper:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>rostopic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>/franka_gripper/stop/goal<span class="w"> </span>franka_gripper/StopActionGoal<span class="w"> </span><span class="o">{}</span>
</pre></div>
</div>
<p>Note that the contact forces disappear now, since no force is applied anymore. Alternatively you can also use
the <code class="docutils literal notranslate"><span class="pre">move</span></code> action.</p>
</section>
<section id="customization">
<h3>Customization<a class="headerlink" href="#customization" title="Permalink to this heading"></a></h3>
<p>The launch file from <code class="docutils literal notranslate"><span class="pre">franka_gazebo</span></code> takes a lot of arguments with which you can customize the behavior
of the simulation. For example to spawn two pandas in one simulation you can use the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;launch&gt;</span>

<span class="w">  </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Start paused, simulation will be started, when Pandas were loaded --&gt;</span>
<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;paused&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;use_sim_time&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/include&gt;</span>

<span class="w">  </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">ns=</span><span class="s">&quot;panda_1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find franka_gazebo)/launch/panda.launch&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arm_id&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;panda_1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y&quot;</span><span class="w">          </span><span class="na">value=</span><span class="s">&quot;-0.5&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;controller&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cartesian_impedance_example_controller&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rviz&quot;</span><span class="w">       </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gazebo&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;paused&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/include&gt;</span>
<span class="w">  </span><span class="nt">&lt;/group&gt;</span>

<span class="w">  </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">ns=</span><span class="s">&quot;panda_2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find franka_gazebo)/launch/panda.launch&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arm_id&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;panda_2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y&quot;</span><span class="w">          </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;controller&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;force_example_controller&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rviz&quot;</span><span class="w">       </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gazebo&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;paused&quot;</span><span class="w">     </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/include&gt;</span>
<span class="w">  </span><span class="nt">&lt;/group&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To see which arguments are supported use: <code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">franka_gazebo</span> <span class="pre">panda.launch</span> <span class="pre">--ros-args</span></code></p>
</div>
</section>
<section id="frankahwsim">
<h3>FrankaHWSim<a class="headerlink" href="#frankahwsim" title="Permalink to this heading"></a></h3>
<p>By default Gazebo ROS can only simulate joints with “standard” hardware interfaces like <cite>Joint State Interfaces</cite>
and <cite>Joint Command Interfaces</cite>. However our robot is quite different from this architecture! Next to
these joint-specific interfaces it also supports <strong>robot-specific</strong> interfaces like the <code class="docutils literal notranslate"><span class="pre">FrankaModelInterface</span></code> (see
<a class="reference internal" href="#franka-hw"><span class="std std-ref">franka_hw</span></a>). Naturally gazebo does not understand these custom hardware interfaces by default.
This is where the <code class="docutils literal notranslate"><span class="pre">FrankaHWSim</span></code> plugin comes in.</p>
<p>To make your robot capable of supporting Franka interfaces, simply declare a custom <code class="docutils literal notranslate"><span class="pre">robotSimType</span></code> in your URDF:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo&gt;</span>
<span class="w">  </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gazebo_ros_control&quot;</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;libgazebo_ros_control.so&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;robotNamespace&gt;</span>${arm_id}<span class="nt">&lt;/robotNamespace&gt;</span>
<span class="w">    </span><span class="nt">&lt;controlPeriod&gt;</span>0.001<span class="nt">&lt;/controlPeriod&gt;</span>
<span class="w">    </span><span class="nt">&lt;robotSimType&gt;</span>franka_gazebo/FrankaHWSim<span class="nt">&lt;/robotSimType&gt;</span>
<span class="w">  </span><span class="nt">&lt;/plugin&gt;</span>
<span class="w">  </span><span class="nt">&lt;self_collide&gt;</span>true<span class="nt">&lt;/self_collide&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>When you spawn this robot with the <a class="reference external" href="http://wiki.ros.org/simulator_gazebo/Tutorials/SpawningObjectInSimulation#Spawn_Model_in_Simulation">model spawner</a> this plugin
will be loaded into the gazebo node. It will scan your URDF and try to find supported hardware interfaces. Up to now
only some of the interfaces provided by <a class="reference internal" href="#franka-hw"><span class="std std-ref">franka_hw</span></a> are supported:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 50%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Interface</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::JointStateInterface</span></code></p></td>
<td><p>Reads joint states.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::EffortJointInterface</span></code></p></td>
<td><p>Commands joint-level torques and reads
joint states.</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::VelocityJointInterface</span></code></p></td>
<td><p>Commands joint velocities and reads joint
states.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hardware_interface::PositionJointInterface</span></code></p></td>
<td><p>Commands joint positions and reads joint
states.</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaStateInterface</span></code></p></td>
<td><p>Reads the full robot state.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaModelInterface</span></code></p></td>
<td><p>Reads the dynamic and kinematic model of the
robot.</p></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaPoseCartesianInterface</span></code></p></td>
<td><p>Commands Cartesian poses and reads the full
robot state.</p></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaVelocityCartesianInterface</span></code></p></td>
<td><p>Commands Cartesian velocities and reads the
full robot state.</p></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This implies that you can only simulate controllers, that claim these supported interfaces and none other!
For example the Cartesian Impedance Example Controller can be simulated, because it only requires the
<code class="docutils literal notranslate"><span class="pre">EffortJoint</span></code>-, <code class="docutils literal notranslate"><span class="pre">FrankaState</span></code>- and <code class="docutils literal notranslate"><span class="pre">FrankaModelInterface</span></code>. However the Joint Impedance Example Controller
can’t be simulated, because it requires the <code class="docutils literal notranslate"><span class="pre">FrankaPoseCartesianInterface</span></code> which is not supported yet.</p>
</div>
<p>Next to the realtime hardware interfaces the <code class="docutils literal notranslate"><span class="pre">FrankaHWSim</span></code> plugin supports some of the non-realtime commands
that <a class="reference internal" href="#franka-control"><span class="std std-ref">franka_control</span></a> supports:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 40%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Service / Type</p></th>
<th class="head"><p>Explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_joint_impedance</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetJointImpedance.html">SetJointImpedance</a></p></td>
<td><p>Gazebo does not simulate an internal impedance
controller, but sets commanded torques directly</p></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_cartesian_impedance</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetCartesianImpedance.html">SetCartesianImpedance</a></p></td>
<td><p>Gazebo does not simulate an internal impedance
controller, but sets commanded torques directly</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_EE_frame</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetEEFrame.html">SetEEFrame</a></p></td>
<td><p>Sets the <span class="math notranslate nohighlight">\({}^{\mathrm{NE}}\mathbf{T}_{\mathrm{EE}}\)</span>
i.e. the homogenous transformation from nominal end-effector
to end-effector. You can also initialize this by setting the
ROS parameter <code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/NE_T_EE</span></code>. Normally you would set
<span class="math notranslate nohighlight">\({}^{\mathrm{F}}\mathbf{T}_{\mathrm{NE}}\)</span> in Desk, but
in <code class="docutils literal notranslate"><span class="pre">franka_gazebo</span></code> it’s assumed as identity if no gripper
was specified or defines a rotation around Z by <span class="math notranslate nohighlight">\(45\:°\)</span>
and an offset by <span class="math notranslate nohighlight">\(10.34\:cm\)</span> (same as Desk for the
hand). You can always overwrite this value by setting the ROS
parameter <code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/NE_T_EE</span></code> manually.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_K_frame</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetKFrame.html">SetKFrame</a></p></td>
<td><p>Sets the <span class="math notranslate nohighlight">\({}^{\mathrm{EE}}\mathbf{T}_{\mathrm{K}}\)</span> i.e.
the homogenous transformation from end-effector to stiffness
frame.</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_force_torque_collision_behavior</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetForceTorqueCollisionBehavior.html">SetForceTorqueCollisionBehavior</a></p></td>
<td><p>Sets thresholds above which external wrenches are treated as
contacts and collisions.</p></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_full_collision_behavior</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetFullCollisionBehavior.html">SetFullCollisionBehavior</a></p></td>
<td><p>Not yet implemented</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_load</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/franka_msgs/html/srv/SetLoad.html">SetLoad</a></p></td>
<td><p>Sets an external load to compensate its gravity for, e.g. of
a grasped object. You can also initialize this by setting
the ROS parameters <code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/{m_load,I_load,F_x_load}</span></code>
for mass, inertia tensor and center of mass for the load,
respectively.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">set_user_stop</span></code> /
<a class="reference external" href="http://docs.ros.org/en/noetic/api/std_srvs/html/srv/SetBool.html">std_srvs::SetBool</a>
(since 0.9.1)</p></td>
<td><p>This is a special service only available in <code class="docutils literal notranslate"><span class="pre">franka_gazebo</span></code>
to simulate the user stop. Pressing the user stop (a.k.a
publishing a <code class="docutils literal notranslate"><span class="pre">true</span></code> via this service) will <em>disconnect</em>
all command signals from ROS controllers to be fed to the
joints. To connect them again call the <code class="docutils literal notranslate"><span class="pre">error_recovery</span></code>
action.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="frankagrippersim">
<h3>FrankaGripperSim<a class="headerlink" href="#frankagrippersim" title="Permalink to this heading"></a></h3>
<p>This plugin simulates the <a class="reference internal" href="#franka-gripper"><span class="std std-ref">franka_gripper_node</span></a> in Gazebo. This is done as a ROS controller for
the two finger joints with a position &amp; force controller. It offers the same five actions like the real gripper node:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/franka_gripper/homing</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/franka_gripper/stop</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/franka_gripper/move</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/franka_gripper/grasp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;arm_id&gt;/franka_gripper/gripper_action</span></code></p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">grasp</span></code> action has a bug, that it will not succeed nor abort if the target width
lets the fingers <strong>open</strong>. This is because of missing the joint limits interface which
lets the finger oscillate at their limits. For now only use the <code class="docutils literal notranslate"><span class="pre">grasp</span></code> action to <em>close</em>
the fingers!</p>
</div>
<p>It is assumed that the URDF contains two finger joints which can be force controlled, i.e. have a corresponding
<code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> transmission declared. This controller expects the following parameters in its namespace:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>          (string, required): Should be <code class="docutils literal notranslate"><span class="pre">franka_gazebo/FrankaGripperSim</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arm_id</span></code>        (string, required): The arm id of the panda, to infer the name of the finger joints</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger1/gains/p</span></code> (double, required): The proportional gain for the position-force controller of the first finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger1/gains/i</span></code> (double, default: 0): The integral gain for the position-force controller of the first finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger1/gains/d</span></code> (double, default: 0): The differential gain for the position-force controller of the first finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger2/gains/p</span></code> (double, required): The proportional gain for the position-force controller of the second finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger2/gains/i</span></code> (double, default: 0): The integral gain for the position-force controller of the second finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finger2/gains/d</span></code> (double, default: 0): The differential gain for the position-force controller of the second finger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">move/width_tolerance</span></code> (double, default <span class="math notranslate nohighlight">\(5\:mm\)</span>): The move action succeeds, when the finger width becomes
below this threshold</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grasp/resting_threshold</span></code> (double, default <span class="math notranslate nohighlight">\(1\:\frac{mm}{s}\)</span>):  Below which speed the target width should
be checked to abort or succeed the grasp action</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grasp/consecutive_samples</span></code> (double, default: 3): How many times the speed has to be consecutively below
<code class="docutils literal notranslate"><span class="pre">resting_threshold</span></code> before the grasping will be evaluated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gripper_action/width_tolerance</span></code> (double, default <span class="math notranslate nohighlight">\(5\:mm\)</span>): The gripper action succeeds, when the finger
width becomes below this threshold</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gripper_action/speed</span></code> (double, default <span class="math notranslate nohighlight">\(10\:\frac{cm}{s}\)</span>): The speed to use during the gripper action</p></li>
</ul>
</section>
<section id="jointstateinterface">
<h3>JointStateInterface<a class="headerlink" href="#jointstateinterface" title="Permalink to this heading"></a></h3>
<p>To be able to access the joint state interface from a ROS controller you only have to declare the corresponding
joint in any transmission tag in the URDF. Then a joint state interface will be automatically available. Usually
you declare transmission tags for command interfaces like the <a class="reference internal" href="#effort-joint-interface"><span class="std std-ref">EffortJointInterface</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For any joint named <code class="docutils literal notranslate"><span class="pre">&lt;arm_id&gt;_jointN</span></code> (with N as integer) FrankaHWSim will automatically compensate its gravity
to mimic the behavior of libfranka.</p>
</div>
</section>
<section id="effortjointinterface">
<span id="effort-joint-interface"></span><h3>EffortJointInterface<a class="headerlink" href="#effortjointinterface" title="Permalink to this heading"></a></h3>
<p>To be able to send effort commands from your controller to a joint, you simply declare a transmission tag for the
joint in your URDF with the corresponding hardware interface type:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;transmission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${joint}_transmission&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
<span class="w"> </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${joint}&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
<span class="w"> </span><span class="nt">&lt;/joint&gt;</span>
<span class="w"> </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${joint}_motor&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;hardwareInterface&gt;</span>${transmission}<span class="nt">&lt;/hardwareInterface&gt;</span>
<span class="w"> </span><span class="nt">&lt;/actuator&gt;</span>
<span class="nt">&lt;/transmission&gt;</span>

<span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;${joint}&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- Needed for ODE to output external wrenches on joints --&gt;</span>
<span class="w">  </span><span class="nt">&lt;provideFeedback&gt;</span>true<span class="nt">&lt;/provideFeedback&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to be able to read external forces or torques, which come e.g. from collisions, make sure to set the
<code class="docutils literal notranslate"><span class="pre">&lt;provideFeedback&gt;</span></code> tag to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</div>
</section>
<section id="frankastateinterface">
<h3>FrankaStateInterface<a class="headerlink" href="#frankastateinterface" title="Permalink to this heading"></a></h3>
<p>This is a <strong>robot-specific</strong> interface and thus a bit different from the normal hardware interfaces.
To be able to access the franka state interface from your controller declare the following transmission tag with
all seven joints in your URDF:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;transmission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_franka_state&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;type&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/type&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint1&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint2&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint3&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint4&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint5&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint6&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_joint7&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/joint&gt;</span>

<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor1&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor2&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor3&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor4&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor5&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor6&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_motor7&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaStateInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="nt">&lt;/transmission&gt;</span>
</pre></div>
</div>
<p>When your controller accesses the <a class="reference external" href="https://frankarobotics.github.io/libfranka/0.15.0/structfranka_1_1RobotState.html">RobotState</a> via the <code class="docutils literal notranslate"><span class="pre">FrankaStateInterface</span></code> it can
expect the following values to be simulated:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 31%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_T_EE</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_T_EE_d</span></code></p></td>
<td><p>Motion generation not yet supported, field will contain only zeros</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F_T_EE</span></code></p></td>
<td><p>Can be configured via parameters <code class="docutils literal notranslate"><span class="pre">F_T_NE</span></code>, <code class="docutils literal notranslate"><span class="pre">NE_T_EE</span></code> and/or
service calls to <code class="docutils literal notranslate"><span class="pre">set_EE_frame</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NE_T_EE</span></code></p></td>
<td><p>Can be configured via parameter <code class="docutils literal notranslate"><span class="pre">NE_T_EE</span></code> and/or service calls
to <code class="docutils literal notranslate"><span class="pre">set_EE_frame</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">EE_T_K</span></code></p></td>
<td><p>Can be configured via parameter <code class="docutils literal notranslate"><span class="pre">EE_T_K</span></code> and/or service calls
to <code class="docutils literal notranslate"><span class="pre">set_K_frame</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">m_ee</span></code></p></td>
<td><p>Will be set from the mass in the inertial tag of URDF, if a hand can
be found, otherwise zero. Can be overwritten by parameter <code class="docutils literal notranslate"><span class="pre">m_ee</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">I_ee</span></code></p></td>
<td><p>Will be set from the inertia in the inertial tag of URDF, if a hand
be found, otherwise zero. Can be overwritten by parameter <code class="docutils literal notranslate"><span class="pre">I_ee</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F_x_Cee</span></code></p></td>
<td><p>Will be set from the origin in the inertial tag of URDF, if a hand can
be found, otherwise zero. Can be overwritten by parameter <code class="docutils literal notranslate"><span class="pre">F_x_Cee</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">m_load</span></code></p></td>
<td><p>Can be configured via parameter <code class="docutils literal notranslate"><span class="pre">m_load</span></code> and/or service calls to
<code class="docutils literal notranslate"><span class="pre">set_load</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">I_load</span></code></p></td>
<td><p>Can be configured via parameter <code class="docutils literal notranslate"><span class="pre">I_load</span></code> and/or service calls to
<code class="docutils literal notranslate"><span class="pre">set_load</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F_x_Cload</span></code></p></td>
<td><p>Can be configured via parameter <code class="docutils literal notranslate"><span class="pre">F_x_Cload</span></code> and/or service calls to
<code class="docutils literal notranslate"><span class="pre">set_load</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">m_total</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">I_total</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F_x_Ctotal</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">elbow</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">elbow_d</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">elbow_c</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delbow_d</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delbow_c</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tau_J</span></code></p></td>
<td><p>Comes directly from Gazebo</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tau_J_d</span></code></p></td>
<td><p>The values send by your effort controller. Zero otherwise.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dtau_J</span></code></p></td>
<td><p>Numerical derivative of <code class="docutils literal notranslate"><span class="pre">tau_J</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">q</span></code></p></td>
<td><p>Comes directly from Gazebo</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">q_d</span></code></p></td>
<td><p>The last commanded joint position when using the position interface.
Same as <code class="docutils literal notranslate"><span class="pre">q</span></code> when using the velocity interface. However,
the value will not be updated when using the effort interface.</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dq</span></code></p></td>
<td><p>Comes directly from Gazebo</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dq_d</span></code></p></td>
<td><p>The last commanded joint velocity when using the velocity interface.
Same as <code class="docutils literal notranslate"><span class="pre">dq</span></code> when using the position interface. However,
the value will be zero when using the effort interface.</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ddq_d</span></code></p></td>
<td><p>Current acceleration when using the position or velocity interface.
However, the value will be zero when using the effort interface.</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">joint_contact</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mid \hat{\tau}_{ext} \mid &gt; \mathrm{thresh}_{lower}\)</span> where the
threshold can be set by calling <code class="docutils literal notranslate"><span class="pre">set_force_torque_collision_behavior</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">joint_collision</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mid \hat{\tau}_{ext} \mid &gt; \mathrm{thresh}_{upper}\)</span> where the
threshold can be set by calling <code class="docutils literal notranslate"><span class="pre">set_force_torque_collision_behavior</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cartesian_contact</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mid {}^K \hat{F}_{K,ext} \mid &gt; \mathrm{thresh}_{lower}\)</span> where
threshold can be set by calling <code class="docutils literal notranslate"><span class="pre">set_force_torque_collision_behavior</span></code></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cartesian_collision</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\mid {}^K \hat{F}_{K,ext} \mid &gt; \mathrm{thresh}_{upper}\)</span> where
threshold can be set by calling <code class="docutils literal notranslate"><span class="pre">set_force_torque_collision_behavior</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tau_ext_hat_filtered</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{\tau}_{ext}\)</span> i.e. estimated external torques and forces at
the end-effector, filtered with a exponential moving average filter
(EMA). This filtering <span class="math notranslate nohighlight">\(\alpha\)</span> can be configured via a ROS
parameter. This field does not contain any gravity, i.e.
<span class="math notranslate nohighlight">\(\tau_{ext} = \tau_J - \tau_{J_d} - \tau_{gravity}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_F_ext_hat_K</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\({}^O\hat{F}_{K,ext} = J_O^{\top +} \cdot \hat{\tau}_{ext}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">K_F_ext_hat_K</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\({}^K\hat{F}_{K,ext} = J_K^{\top +} \cdot \hat{\tau}_{ext}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_dP_EE_d</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_ddP_0</span></code></p></td>
<td><p>Will be the same as the <code class="docutils literal notranslate"><span class="pre">gravity_vector</span></code> ROS parameter.
By  default it is {0,0,-9.8}</p></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_T_EE_c</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_dP_EE_c</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">O_ddP_EE_c</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">theta</span></code></p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">q</span></code>, since we don’t simulate soft joints in Gazebo</p></td>
</tr>
<tr class="row-even"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dtheta</span></code></p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">dq</span></code>, since we don’t simulate soft joints in Gazebo</p></td>
</tr>
<tr class="row-odd"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">current_errors</span></code></p></td>
<td><p>Will entirely be false, reflex system not yet implemented</p></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">last_motion_errors</span></code></p></td>
<td><p>Will entirely be false, reflex system not yet implemented</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_command_success_rate</span></code></p></td>
<td><p>Always 1.0</p></td>
</tr>
<tr class="row-even"><td><p>✘</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">robot_mode</span></code></p></td>
<td><p>Robot mode switches and reflex system not yet implemented</p></td>
</tr>
<tr class="row-odd"><td><p>✔</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td><p>Current ROS time in simulation, comes from Gazebo</p></td>
</tr>
</tbody>
</table>
</section>
<section id="frankamodelinterface">
<h3>FrankaModelInterface<a class="headerlink" href="#frankamodelinterface" title="Permalink to this heading"></a></h3>
<p>This is a <strong>robot-specific</strong> interface and thus a bit different from the normal hardware interfaces.
To be able to access the franka model interface from your controller declare the following transmission tag with
the root (e.g. <code class="docutils literal notranslate"><span class="pre">panda_joint1</span></code>) and the tip (e.g. <code class="docutils literal notranslate"><span class="pre">panda_joint8</span></code>) of your kinematic chain in your URDF:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;transmission</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${arm_id}_franka_model&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;type&gt;</span>franka_hw/FrankaModelInterface<span class="nt">&lt;/type&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${root}&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;role&gt;</span>root<span class="nt">&lt;/role&gt;</span>
<span class="w">    </span><span class="nt">&lt;hardwareInterface&gt;</span>franka_hw/FrankaModelInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
<span class="w">  </span><span class="nt">&lt;/joint&gt;</span>
<span class="w">  </span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${tip}&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;role&gt;</span>tip<span class="nt">&lt;/role&gt;</span>
<span class="w">    </span><span class="nt">&lt;hardwareInterface&gt;</span>franka_hw/FrankaModelInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
<span class="w">  </span><span class="nt">&lt;/joint&gt;</span>

<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${root}_motor_root&quot;</span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaModelInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="w">  </span><span class="nt">&lt;actuator</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;${tip}_motor_tip&quot;</span><span class="w">  </span><span class="nt">&gt;&lt;hardwareInterface&gt;</span>franka_hw/FrankaModelInterface<span class="nt">&lt;/hardwareInterface&gt;&lt;/actuator&gt;</span>
<span class="nt">&lt;/transmission&gt;</span>
</pre></div>
</div>
<p>The model functions themselve are implemented with <a class="reference external" href="https://www.orocos.org/kdl.html">KDL</a>. This takes the kinematic
structure and the inertial properties from the URDF to calculate model properties like the Jacobian or the mass matrix.</p>
</section>
<section id="friction">
<h3>Friction<a class="headerlink" href="#friction" title="Permalink to this heading"></a></h3>
<p>For objects to have proper friction between each other (like fingers and objects) you need to tune
some Gazebo parameters in your URDF. For the links <code class="docutils literal notranslate"><span class="pre">panda_finger_joint1</span></code> and <code class="docutils literal notranslate"><span class="pre">panda_finger_joint2</span></code> we recommend to
set the following parameters:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;${link}&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;collision&gt;</span>
<span class="w">    </span><span class="nt">&lt;max_contacts&gt;</span>10<span class="nt">&lt;/max_contacts&gt;</span>
<span class="w">    </span><span class="nt">&lt;surface&gt;</span>
<span class="w">      </span><span class="nt">&lt;contact&gt;</span>
<span class="w">        </span><span class="nt">&lt;ode&gt;</span>
<span class="w">          </span><span class="cm">&lt;!-- These two parameter need application specific tuning. --&gt;</span>
<span class="w">          </span><span class="cm">&lt;!-- Usually you want no &quot;snap out&quot; velocity and a generous --&gt;</span>
<span class="w">          </span><span class="cm">&lt;!-- penetration depth to keep the grasping stable --&gt;</span>
<span class="w">          </span><span class="nt">&lt;max_vel&gt;</span>0<span class="nt">&lt;/max_vel&gt;</span>
<span class="w">          </span><span class="nt">&lt;min_depth&gt;</span>0.003<span class="nt">&lt;/min_depth&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ode&gt;</span>
<span class="w">      </span><span class="nt">&lt;/contact&gt;</span>
<span class="w">      </span><span class="nt">&lt;friction&gt;</span>
<span class="w">        </span><span class="nt">&lt;ode&gt;</span>
<span class="w">          </span><span class="cm">&lt;!-- Rubber/Rubber contact --&gt;</span>
<span class="w">          </span><span class="nt">&lt;mu&gt;</span>1.16<span class="nt">&lt;/mu&gt;</span>
<span class="w">          </span><span class="nt">&lt;mu2&gt;</span>1.16<span class="nt">&lt;/mu2&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ode&gt;</span>
<span class="w">      </span><span class="nt">&lt;/friction&gt;</span>
<span class="w">      </span><span class="nt">&lt;bounce/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/surface&gt;</span>
<span class="w">  </span><span class="nt">&lt;/collision&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a class="reference external" href="https://classic.gazebosim.org/tutorials?tut=friction">Gazebo Friction Documentation</a></p>
</div>
</section>
</section>
<section id="franka-msgs">
<h2>franka_msgs<a class="headerlink" href="#franka-msgs" title="Permalink to this heading"></a></h2>
<p>This package contains message, service and action types that are primarily used the packages
<code class="docutils literal notranslate"><span class="pre">franka_hw</span></code> and <code class="docutils literal notranslate"><span class="pre">franka_control</span></code> to publish robot states or to expose the libfranka API
in the ROS ecosystem. For more information about the services and actions offered in this
package, please refer to <a class="reference internal" href="#franka-control"><span class="std std-ref">franka_control</span></a>.</p>
</section>
<section id="panda-moveit-config">
<h2>panda_moveit_config<a class="headerlink" href="#panda-moveit-config" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This package was moved to the <a class="reference external" href="https://github.com/ros-planning/panda_moveit_config">ros_planning repos</a>.</p>
</div>
<p>For more details, documentation and tutorials, please have a look at the
<a class="reference external" href="https://docs.ros.org/en/kinetic/api/moveit_tutorials/html/index.html">MoveIt! tutorials website</a>.</p>
</section>
<section id="writing-your-own-controller">
<span id="write-own-controller"></span><h2>Writing  your own controller<a class="headerlink" href="#writing-your-own-controller" title="Permalink to this heading"></a></h2>
<p>All example controllers from the <a class="reference internal" href="#example-controllers"><span class="std std-ref">example controllers package</span></a> are
derived from the <code class="docutils literal notranslate"><span class="pre">controller_interface::MultiInterfaceController</span></code> class, which allows to claim
up to four interfaces in one controller instance. The declaration of your class then looks like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NameOfYourControllerClass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">controller_interface</span><span class="o">::</span><span class="n">MultiInterfaceController</span><span class="w"> </span><span class="o">&lt;</span>
<span class="w">                              </span><span class="n">my_mandatory_first_interface</span><span class="p">,</span>
<span class="w">                              </span><span class="n">my_possible_second_interface</span><span class="p">,</span>
<span class="w">                              </span><span class="n">my_possible_third_interface</span><span class="p">,</span>
<span class="w">                              </span><span class="n">my_possible_fourth_interface</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">init</span><span class="w"> </span><span class="p">(</span><span class="n">hardware_interface</span><span class="o">::</span><span class="n">RobotHW</span><span class="o">*</span><span class="w"> </span><span class="n">hw</span><span class="p">,</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">nh</span><span class="p">);</span><span class="w">  </span><span class="c1">// mandatory</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="o">&amp;</span><span class="w"> </span><span class="n">period</span><span class="p">);</span><span class="w">  </span><span class="c1">// mandatory</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">starting</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">)</span><span class="w">   </span><span class="c1">// optional</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">stopping</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">);</span><span class="w">  </span><span class="c1">// optional</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The available interfaces are described in Section <a class="reference internal" href="#franka-hw"><span class="std std-ref">franka_hw</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that the claimable combinations of commanding interfaces are restricted as it does not
make sense to e.g. command joint positions and Cartesian poses simultaneously. Read-only
interfaces like the <em>JointStateInterface</em>, the <em>FrankaStateInterface</em> or the
<em>FrankaModelInterface</em> can always be claimed and are not subject to restrictions.</p>
</div>
<p>Possible claims to command interfaces are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">franka_hw::FrankaHW</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">franka_combinable_hw::FrankaCombinableHW</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ul class="simple">
<li><p>all possible single interface claims</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">PositionJointInterface</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">VelocityJointInterface</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">FrankaCartesianPoseInterface</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">FrankaCartesianVelocityInterface</span></code></p></li>
</ul>
</td>
<td><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">FrankaCartesianPoseInterface</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EffortJointInterface</span></code> +
<code class="docutils literal notranslate"><span class="pre">FrankaCartesianVelocityInterface</span></code></p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The idea behind offering the <em>EffortJointInterface</em> in combination with a motion generator
interface is to expose the internal motion generators to the user. The calculated desired joint
pose corresponding to a motion generator command is available in the robot state one time step
later. One use case for this combination would be following a Cartesian trajectory using your own
joint-level torque controller. In this case you would claim the combination <em>EffortJointInterface</em>
+ <em>FrankaCartesianPoseInterface</em>, stream your trajectory into the <em>FrankaCartesianPoseInterface</em>,
and compute your joint-level torque commands based on the resulting desired joint pose (q_d) from
the robot state. This allows to use the robot’s built-in inverse kinematics instead of having to
solve it on your own.</p>
<p>To implement a fully functional controller you have to implement at least the inherited virtual
functions <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">update</span></code>. Initializing - e.g. start poses - should be done in the
<code class="docutils literal notranslate"><span class="pre">starting</span></code> function as <code class="docutils literal notranslate"><span class="pre">starting</span></code> is called when restarting the controller, while <code class="docutils literal notranslate"><span class="pre">init</span></code> is
called only once when loading the controller. The <code class="docutils literal notranslate"><span class="pre">stopping</span></code> method should contain shutdown
related functionality (if needed).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Always command a gentle slowdown before shutting down the controller. When using velocity
interfaces, do not simply command zero velocity in <code class="docutils literal notranslate"><span class="pre">stopping</span></code>. Since it might be called
while the robot is still moving, it would be equivalent to commanding a jump in velocity
leading to very high resulting joint-level torques. In this case it would be better to keep the
same velocity and stop the controller than sending zeros and let the robot handle
the slowdown.</p>
</div>
<p>Your controller class must be exported correctly with <code class="docutils literal notranslate"><span class="pre">pluginlib</span></code> which requires adding:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pluginlib/class_list_macros.h&gt;</span>
<span class="c1">// Implementation ..</span>
<span class="n">PLUGINLIB_EXPORT_CLASS</span><span class="p">(</span><span class="n">name_of_your_controller_package</span><span class="o">::</span><span class="n">NameOfYourControllerClass</span><span class="p">,</span>
<span class="w">                       </span><span class="n">controller_interface</span><span class="o">::</span><span class="n">ControllerBase</span><span class="p">)</span>
</pre></div>
</div>
<p>at the end of the <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file. In addition you need to define a <code class="docutils literal notranslate"><span class="pre">plugin.xml</span></code> file with the
following content:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;library</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;lib/lib&lt;name_of_your_controller_library&gt;&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name_of_your_controller_package/NameOfYourControllerClass&quot;</span>
<span class="w">         </span><span class="na">type=</span><span class="s">&quot;name_of_your_controller_package::NameOfYourControllerClass&quot;</span>
<span class="w">         </span><span class="na">base_class_type=</span><span class="s">&quot;controller_interface::ControllerBase&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>
<span class="w">      </span>Some<span class="w"> </span>text<span class="w"> </span>to<span class="w"> </span>describe<span class="w"> </span>what<span class="w"> </span>your<span class="w"> </span>controller<span class="w"> </span>is<span class="w"> </span>doing
<span class="w">    </span><span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/library&gt;</span>
</pre></div>
</div>
<p>which is exported by adding:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;export&gt;</span>
<span class="w">  </span><span class="nt">&lt;controller_interface</span><span class="w"> </span><span class="na">plugin=</span><span class="s">&quot;${prefix}/plugin.xml&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/export&gt;</span>
</pre></div>
</div>
<p>to your package.xml. Further, you need to load at least a controller name in combination with a
controller type to the ROS parameter server. Additionally, you can include other parameters you
need. An exemplary configuration.yaml file can look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">your_custom_controller_name</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name_of_your_controller_package/NameOfYourControllerClass</span>
<span class="w">  </span><span class="nt">additional_example_parameter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">  </span><span class="c1"># ..</span>
</pre></div>
</div>
<p>Now you can start your controller using the <code class="docutils literal notranslate"><span class="pre">controller_spawner</span></code> node from ROS control or via the
service calls offered by the <code class="docutils literal notranslate"><span class="pre">hardware_manager</span></code>. Just make sure that both the
<code class="docutils literal notranslate"><span class="pre">controller_spawner</span></code> and the <code class="docutils literal notranslate"><span class="pre">franka_control_node</span></code> run in the same namespace. For more details
have a look at the controllers from the
<a class="reference internal" href="#example-controllers"><span class="std std-ref">franka_example_controllers package</span></a> or the
<a class="reference external" href="http://wiki.ros.org/ros_control/Tutorials">ROS control tutorials</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="libfranka.html" class="btn btn-neutral float-left" title="libfranka" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="franka_ros2.html" class="btn btn-neutral float-right" title="franka_ros2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Franka Robotics GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>